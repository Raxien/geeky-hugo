{{ define "main" }}

<!--=================== contact section start ===================-->
<section class="section contact">
  <div class="container">
    {{ $bgImage:= resources.Get "images/map.png" }}
    {{ $bgImage:= $bgImage.Resize "1400x webp" }}
    <div class="row section-sm pt-0" style="background-image: url('{{ $bgImage.RelPermalink }}')">
      <div class="col-lg-6">
        <div class="content pt-lg-5 pb-3 pb-lg-0">
          <h2>Contattaci</h2>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="p-4 border rounded-4">
          <h3 class="h4 mb-5 text-capitalize">Mandaci un
            <span class="text-primary"> messaggio <i class="fas fa-arrow-right ms-2"></i></span>
          </h3>
          <form id="contactForm" action="{{site.Params.contact_form_action | safeURL}}" method="POST">
            <!-- <div class="form-group">
              <label for="name" class="form-label">Nome <small>*</small></label>
              <input type="text" class="form-control" name="name" id="name" placeholder="Sakè Olimpia" required>
            </div> -->
            <div class="form-group">
              <label for="email" class="form-label">Email <small>*</small></label>
              <input type="email" name="email" class="form-control" id="email" placeholder="esempio@email.com" required>
            </div>
            <!-- <div class="form-group">
              <label for="isSponsor" class="form-label">Sei un'azienda?</label>              
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="isSponsor">
                <label class="form-check-label" for="isSponsor">
                  Si
                </label>
              </div>
            </div> -->
            <div class="form-group">
              <label for="name" class="form-label">Oggetto <small>*</small></label>
              <input type="text" class="form-control" name="subject" id="subject" placeholder=""
                required>
            </div>
            <div class="form-group">
              <label for="message" class="form-label">Il tuo messaggio <small>*</small></label>
              <textarea class="form-control" placeholder="" id="message"
                name="message" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary" id="submitButton">
              <span class="button-text">Invia</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="row g-4">
      {{ with site.Params.mobile }}
      <div class="col-lg-4">
        <div class="card text-center">
          <a href="tel:{{.}}"><i class="fas fa-user text-primary"></i>{{.}}</a>
        </div>
      </div>
      {{ end }}
      {{ with site.Params.email }}
      <div class="col-lg-4">
        <div class="card text-center">
          <a href="mailto:{{.}}"><i class="fas fa-envelope text-primary"></i>{{.}}</a>
        </div>
      </div>
      {{ end }}
      {{ with site.Params.instagram }}
      <div class="col-lg-4">
        <div class="card text-center">
          <li>
            <i class="fas fa-map-marker-alt text-primary"></i>{{ .| markdownify}}
          </li>
        </div>
      </div>
      {{ end }}
      {{ with site.Params.address }}
      <div class="col-lg-4">
        <div class="card text-center">
          <li>
            <i class="fas fa-map-marker-alt text-primary"></i>{{ .| markdownify}}
          </li>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
<!--=================== contact section start ===================-->

<!--=================== expanses script start ===================-->
<script>
  const rpcUrl = "https://vandipetyapi.onrender.com"

  function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    // Mostra il toast
    setTimeout(() => toast.classList.add('show'), 100);
    
    // Rimuovi il toast dopo 3 secondi
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 1000);
    }, 3000);
  }

  function toggleButtonLoading(isLoading) {
    const button = document.getElementById('submitButton');
    const buttonText = button.querySelector('.button-text');
    const spinner = button.querySelector('.spinner-border');
    
    if (isLoading) {
      button.disabled = true;
      buttonText.classList.add('d-none');
      spinner.classList.remove('d-none');
    } else {
      button.disabled = false;
      buttonText.classList.remove('d-none');
      spinner.classList.add('d-none');
    }
  }

  function sendMail(event) {
    event.preventDefault();
    
    toggleButtonLoading(true);
    
    const data = {
      "from": document.getElementById("email").value,
      "isSponsor": 0,
      "subject": document.getElementById("subject").value,
      "text": document.getElementById("message").value
    }
    
    fetch(rpcUrl + "/mail/sendMail?" + new URLSearchParams(data), {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json; charset=utf-8'
      }
    })
    .then(response => response.json())
    .then(data => {
      showToast('Abbiamo ricevuto la tua email.');
      document.getElementById("email").value = '';
      document.getElementById("subject").value = '';
      document.getElementById("message").value = '';
      toggleButtonLoading(false);
    })
    .catch(error => {
      console.error('Error:', error);
      showToast('Non siamo riusciti a ricevere la tua email :( riprova più tardi.');
      toggleButtonLoading(false);
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById("contactForm").addEventListener('submit', sendMail);
  });
</script>
<!--=================== expanses script end ===================-->
{{ end }}