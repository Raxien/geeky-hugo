<!-- JS Plugins -->
{{ range site.Params.plugins.js}}
<script src="{{ .link | absURL }}" {{ if .defer }}defer{{ end }} {{ if .async }}async{{ end }}></script>
{{ end }}

<!-- Main Script -->
{{ $script := resources.Get "js/script.js" | minify}}
<script src="{{ $script.Permalink }}" defer></script>

<!-- Google Analytics -->
{{ if site.Params.googleAnalytics }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.Params.googleAnalytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ site.Params.googleAnalytics }}');
</script>
{{ end }}

<!-- Prefetch per domini esterni -->
<link rel="prefetch" href="https://pagead2.googlesyndication.com" as="document">
<link rel="prefetch" href="https://www.googletagmanager.com" as="document">
<link rel="prefetch" href="https://www.google-analytics.com" as="document">

<!-- Lazy loading per immagini -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));
    
    if ("IntersectionObserver" in window) {
      let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            let lazyImage = entry.target;
            lazyImage.src = lazyImage.dataset.src;
            if (lazyImage.dataset.srcset) {
              lazyImage.srcset = lazyImage.dataset.srcset;
            }
            lazyImage.classList.remove("lazy");
            lazyImageObserver.unobserve(lazyImage);
          }
        });
      });

      lazyImages.forEach(function(lazyImage) {
        lazyImageObserver.observe(lazyImage);
      });
    }
  });
</script>

<!-- Search script -->
{{ $search := resources.Get "js/search.js" | resources.Minify }}
{{ if $search }}
<script src="{{ $search.RelPermalink }}" defer></script>
{{ end }}

{{$pf:= site.Params.variables.font_primary}}
{{$sf:= site.Params.variables.font_secondary}}

<!-- cookie -->
{{ with site.Params.cookies }}
{{ if .enable }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js" defer></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide" style="visibility: hidden;">
	{{.content | markdownify}}<span id="js-cookie-button" class="btn btn-sm btn-outline-primary ms-2">{{.button}}</span>
</div>
<script type="application/javascript">
	document.addEventListener('DOMContentLoaded', function() {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		
		if (cookieBox && cookieButton) {
			if (!Cookies.get('cookie-box')) {
				cookieBox.classList.remove('cookie-box-hide');
				cookieButton.addEventListener('click', function() {
					Cookies.set('cookie-box', true, {
						expires: "{{ .expire_days }}"
					});
					cookieBox.classList.add('cookie-box-hide');
				});
			}
		}
	});
</script>
{{ end }}
{{ end }}
