function initBootstrapDependentCode(){const e=document.querySelector(".toggle-side-nav"),t=document.getElementById("offcanvasRight");if(e&&t){const n=document.createElement("div");n.className="offcanvas-backdrop fade",document.body.appendChild(n),e.addEventListener("click",handleMenuToggle),e.addEventListener("touchstart",handleMenuToggle);const a=t.querySelector(".btn-close");a&&(a.addEventListener("click",closeMenu),a.addEventListener("touchstart",closeMenu)),n.addEventListener("click",closeMenu),n.addEventListener("touchstart",closeMenu),document.addEventListener("keydown",handleEscape)}document.querySelectorAll(".collapse").forEach((e=>{e.addEventListener("shown.bs.collapse",(function(){const e=this.parentElement.querySelector(".fas.fa-plus");e&&(e.classList.remove("fas","fa-plus"),e.classList.add("fas","fa-minus"))})),e.addEventListener("hidden.bs.collapse",(function(){const e=this.parentElement.querySelector(".fas.fa-minus");e&&(e.classList.remove("fas","fa-minus"),e.classList.add("fas","fa-plus"))}))}))}function initIndependentCode(){const e=document.querySelector(".preloader");e&&(e.style.display="none");document.querySelectorAll(".toggle-search").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-target");if(e){const t=document.querySelector(e);t&&(t.classList.toggle("open"),setTimeout((()=>{const e=document.getElementById("search-query");e&&e.focus()}),100))}})),e.addEventListener("touchstart",(function(e){e.preventDefault();const t=this.getAttribute("data-target");if(t){const e=document.querySelector(t);e&&(e.classList.toggle("open"),setTimeout((()=>{const e=document.getElementById("search-query");e&&e.focus()}),100))}}))}));document.querySelectorAll(".tab-content .tab-pane").forEach((e=>{const t=e.getAttribute("title"),n=e.closest(".code-tabs");if(n){const e=n.querySelector(".nav-tabs");if(e){const n=document.createElement("li");n.className="nav-item";const a=document.createElement("a");a.className="nav-link",a.href="#",a.textContent=t,n.appendChild(a),e.appendChild(n)}}}));document.querySelectorAll(".code-tabs").forEach((e=>{const t=e.querySelector(".nav-tabs li:first-child"),n=e.querySelector(".tab-content div:first-child");t&&t.classList.add("active"),n&&n.classList.add("active")}));document.querySelectorAll(".nav-tabs a").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.parentElement,n=Array.from(t.parentElement.children).indexOf(t),a=this.closest(".code-tabs"),o=a.querySelectorAll(".tab-pane")[n];a.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),t.classList.add("active"),o.classList.add("active")}))}))}document.addEventListener("touchstart",(function(e){"use strict";e.target.closest(".noPreventDefault")||e.preventDefault()}),{passive:!1}),document.addEventListener("touchmove",(function(e){"use strict";e.target.closest(".noPreventDefault")||e.preventDefault()}),{passive:!1}),window.addEventListener("load",(function(){"use strict";const e=document.querySelector(".preloader");e&&(e.style.display="none")})),window.addEventListener("load",(function(){if(initIndependentCode(),"undefined"!=typeof bootstrap)initBootstrapDependentCode();else{const e=setInterval((()=>{"undefined"!=typeof bootstrap&&(clearInterval(e),initBootstrapDependentCode())}),100)}}));const loadMoreButton=document.getElementById("loadMore");loadMoreButton&&loadMoreButton.addEventListener("click",(async function(){const e=this.dataset.nextUrl;if(e){this.disabled=!0,this.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',this.style.backgroundColor="#15817f";try{const t=await fetch(e),n=await t.text(),a=document.createElement("div");a.innerHTML=n;const o=a.querySelector(".row.mx-0.g-5"),r=document.querySelector(".row.mx-0.g-5");o&&r&&(r.innerHTML+=o.innerHTML);const s=a.querySelector("#loadMore")?.dataset.nextUrl;s?this.dataset.nextUrl=s:this.remove()}catch(e){console.error("Errore nel caricamento dei post:",e),this.innerHTML="Errore nel caricamento"}finally{this.disabled=!1,this.innerHTML="Mostra altro",this.style.backgroundColor="#15817f"}}}));const rpcUrl="https://vandipetyapi.onrender.com",color=["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(229, 122, 250, 1)","rgba(32, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(153, 102, 255, 1)","rgba(102, 178, 255, 1)","rgba(153, 153, 255, 1)","rgba(204, 255, 204, 1)","rgba(255, 153, 153, 1)"];async function fecthExpenseData(){try{const e=await fetch(`${rpcUrl}/sw/getSpeseAnno`),t=await e.json();return processExpenseData(t.json),t}catch(e){console.error("Error fetching SW data:",e)}}async function fecthChartCategoryData(){try{const e=await fetch(`${rpcUrl}/sw/getSpesePerCategoria`),t=await e.json();return setChartCategory(t),t}catch(e){console.error("Error fetching SW data:",e)}}async function fecthChartMonthlyData(){try{const e=await fetch(`${rpcUrl}/sw/getSpesePerMese`),t=await e.json();return setChartMonthly(t),t}catch(e){console.error("Error fetching SW data:",e)}}async function fecthGridData(){try{const e=await fetch(`${rpcUrl}/sw/getSpese`),t=await e.json();return setGrid(t),t}catch(e){console.error("Error fetching SW data:",e)}}function processExpenseData(e){updateUIElements({totalCost:e.totalCost,totalCostWithoutFerry:e.totalCostWithoutFerry,ferryCosts:e.ferryCosts,yearlyTotals:e.yearlyTotals,dailyCost:e.dailyCost,dailyCostWithoutFerry:e.dailyCostWithoutFerry,diffDays:e.tripDay})}function updateUIElements({totalCost:e,totalCostWithoutFerry:t,ferryCosts:n,yearlyTotals:a,dailyCost:o,dailyCostWithoutFerry:r,diffDays:s}){if(document.getElementById("travelingSumCost")){document.getElementById("travelingSumCost").innerText=`${t.toFixed(2)} ‚Ç¨`,document.getElementById("dailyCost").innerText=`${r.toFixed(2)} ‚Ç¨`,document.getElementById("travelingSumCostFerry1").innerText=n.ferry1.toFixed(2),document.getElementById("travelingSumCostFerry2").innerText=n.ferry2.toFixed(2),document.getElementById("dailyCostFerry").innerText=`${o.toFixed(2)} ‚Ç¨ al giorno`,document.getElementById("yearlyCostFerry").innerText=`${e.toFixed(2)} ‚Ç¨`;const i=document.getElementById("yearlyCost");i.innerHTML="",Object.entries(a).forEach((([e,t])=>{const n=document.createElement("div");n.className="col-md-3 mb-3",n.innerHTML=`\n                <h4 class="h5 mb-2">${e}</h4>\n                <h3 class="mb-5 h5">${t.toFixed(2)} ‚Ç¨</h3>\n            `,i.appendChild(n)})),document.getElementById("travelingDay").innerText=s}}function setChartCategory(e){const t=document.getElementById("catergory")?.getContext("2d");if(!t)return;const n=Object.keys(e.json),a=Object.values(e.json);new Chart(t,{type:"doughnut",data:{labels:n,datasets:[{label:"Euro",data:a,backgroundColor:color,borderColor:color,borderWidth:1}]}})}function setChartMonthly(e){const t=document.getElementById("monthly")?.getContext("2d");if(!t)return;const n=Object.keys(e.json),a=Object.values(e.json);new Chart(t,{type:"bar",options:{plugins:{legend:{display:!1}}},data:{labels:n.reverse(),datasets:[{label:"Euro",data:a.reverse(),backgroundColor:color,borderColor:color,borderWidth:1}]}})}function setGrid(e){const t=[];let n=0;for(;n<e.json.length;){let a=e.json[n],o=parseFloat(a.cost);o=Math.round(100*(o+Number.EPSILON))/100,t.push([a.category.name,a.description,o,new Date(a.date).toLocaleString()]),n++}const a=document.getElementById("tblSpese");a&&new gridjs.Grid({columns:["Categoria","Descrizione","Spesa","Data"],data:t,sort:!0,pagination:{limit:20}}).render(a)}function initExpensesPage(){document.getElementById("catergory")&&document.addEventListener("DOMContentLoaded",(async()=>{await fecthExpenseData(),await fecthChartMonthlyData(),await fecthChartCategoryData(),await fecthGridData()}))}function createPressListItem(e){const t=e.info?e.info.replace("#",e.data):"";return`<li><strong><a href="${e.url}">${e.title}</a></strong>${t?` (${t})`:""}</li>`}function sortByDate(e,t){return new Date(e.data).getTime()-new Date(t.data).getTime()}async function buildPressList(){try{const e=document.getElementById("loader"),t=document.getElementById("press");if(!e||!t)return;const n=await fetch(`${rpcUrl}/data/press`),a=(await n.json()).json;a.sort(sortByDate),a.forEach((e=>{const n=e.data.split("/")[2];if(!document.getElementById(n)){const e=document.createElement("h5");e.textContent=n,t.appendChild(e);const a=document.createElement("ul");a.id=n,t.appendChild(a)}document.getElementById(n).insertAdjacentHTML("beforeend",createPressListItem(e))})),e.style.display="none"}catch(e){console.error("Error loading press data:",e);const t=document.getElementById("loader");t&&(t.style.display="none")}}function initPressPage(){document.getElementById("press")&&document.addEventListener("DOMContentLoaded",buildPressList)}function setInsuranceData(e,t){const n=document.getElementById("assicuazione"),a=document.getElementById("bollo");n&&(n.innerText=`${e} ‚Ç¨`),a&&(a.innerText=`${t} ‚Ç¨`)}function setKmData(e){const t=document.getElementById("travelingKm");t&&(t.innerText=e)}function setVanCost(e,t){const n=Object.values(t).reduce(((e,t)=>e+t),0),a=document.getElementById("initialCost"),o=document.getElementById("accessoryCost"),r=document.getElementById("totalVanCost"),s=document.getElementById("tblAccessory");a&&(a.innerText=`${e} ‚Ç¨`),o&&(o.innerText=`${n} ‚Ç¨`),r&&(r.innerText=`${e+n} ‚Ç¨`),s&&new gridjs.Grid({columns:["Accessorio","Costo"],data:Object.entries(t),sort:!0,pagination:{limit:20}}).render(s)}async function getTripData(){try{const e=await fetch(`${rpcUrl}/data/trip`),t=await e.json();return setTripData(t),t}catch(e){console.error("Error fetching trip data:",e)}}function initVanPage(){document.getElementById("travelingKm")&&document.addEventListener("DOMContentLoaded",getTripData)}function updateTripElements({travelingKm:e,visitedCountry:t,travelingDay:n,travelingStartDay:a}){if(!document.getElementById("map"))return;const o={travelingKm:document.getElementById("travelingKm"),visitedCountry:document.getElementById("visitedCountry"),travelingDay:document.getElementById("travelingDay"),travelingStartDay:document.getElementById("travelingStartDay")};e&&o.travelingKm&&(o.travelingKm.innerText=e),t&&o.visitedCountry&&(o.visitedCountry.innerText=t),n&&o.travelingDay&&(o.travelingDay.innerText=n),a&&o.travelingStartDay&&(o.travelingStartDay.innerText=a)}function setTripData(e){const t=e.json;if(document.getElementById("map")){const e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),r=new Date(t.startingDate),s=new Date(`${a}/${o}/${n}`),i=Math.ceil(Math.abs(s-r)/864e5),[c,l,d]=t.startingDate.split("/"),u=`${l}/${c}/${d}`;updateTripElements({travelingKm:t.actualKm,visitedCountry:t.visitedCountry.length,travelingDay:i,travelingStartDay:u})}document.getElementById("initialCost")&&(setVanCost(t.costVan,t.costAccessory),setInsuranceData(t.assicurazione,t.bollo),document.getElementById("travelingKm").innerText=t.actualKm)}function setMap(e){mapboxgl.accessToken="pk.eyJ1IjoicmF4aWVuIiwiYSI6ImNscHA1cDBkNjExMjQybW1zdDdwN2tydmYifQ.dWypGWy2wcMCPjDv5yKGsQ";const t=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",zoom:5,bearing:20,pitch:60,maxZoom:13,minZoom:4,center:[11.25273288631866,45.26401290964107]});t.scrollZoom.disable(),t.touchZoomRotate.enable(),t.addControl(new mapboxgl.NavigationControl);const n=e.pin.filter((e=>e.latlong&&""!==e.latlong&&(!e.date||new Date(e.date)<=new Date))).map((e=>{const t=e.latlong.replace(" ","").split(",").map(parseFloat);return{type:"Feature",properties:{description:`<article class="feature feature-1" style="margin-bottom: 0px;">\n                        <a href="https://youtu.be/${e.vendorid}" class="block" target="_blank" rel="nofollow noopener noreferrer">\n                            <img alt="Image" src="https://img.youtube.com/vi/${e.vendorid}/maxresdefault.jpg" />\n                        </a>\n                        <div class="feature__body boxed boxed--border bg--secondary" style="margin-bottom: 0px;">\n                            <h6>${e.title}</h6>\n                            <p>üìç Scopri gli itinerari <a href="/search/?s=${e.blog}"><span>${e.blog}</span></a></p>\n                        </div>\n                    </article>`},geometry:{type:"Point",coordinates:[t[1],t[0]]}}}));function a(e,n,a,o){const r=n.map((e=>{const[t,n]=e[0].replace(" ","").split(",").map(parseFloat);return[t,n]}));t.addSource(e,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:r}}}),t.addLayer({id:e,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":a,"line-width":4}});const s=document.getElementById("legend"),i=document.createElement("div"),c=document.createElement("span");c.style.backgroundColor=a,i.appendChild(c),i.appendChild(document.createTextNode(o)),s.appendChild(i)}t.on("load",(function(){t.loadImage("https://res.cloudinary.com/ilgattodicitturin/image/upload/v1701600586/asset/red_marker_small_cgzn6u.png",(function(o,r){if(o)throw o;a("route1",e.route[0],"#FFC000","Road to Dakar"),a("route2",e.route[1],"#d98396","Tour dei Balcani"),a("route3",e.route[2],"#91CCF1","Direzione Giappone"),t.addImage("custom-marker",r),t.addLayer({id:"places",type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:n}},layout:{"icon-image":"custom-marker","text-allow-overlap":!0,"icon-allow-overlap":!0}});document.getElementById("legend").style.display="block"}))})),t.on("click","places",(function(e){const n=e.features[0].geometry.coordinates.slice(),a=e.features[0].properties.description;for(;Math.abs(e.lngLat.lng-n[0])>180;)n[0]+=e.lngLat.lng>n[0]?360:-360;(new mapboxgl.Popup).setLngLat(n).setHTML(a).addTo(t)})),t.on("mouseenter","places",(()=>t.getCanvas().style.cursor="pointer")),t.on("mouseleave","places",(()=>t.getCanvas().style.cursor=""))}async function getMapData(){try{const e=await fetch(`${rpcUrl}/data/map`),t=await e.json();return setMap(t.json),t}catch(e){console.error("Error fetching map data:",e)}}function initTripPage(){document.getElementById("map")&&document.addEventListener("DOMContentLoaded",(async()=>{/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);await Promise.all([getTripData(),getMapData()]).catch((e=>console.error("Error initializing data:",e)))}))}function showToast(e){const t=document.createElement("div");t.className="toast",t.textContent=e,document.body.appendChild(t),setTimeout((()=>t.classList.add("show")),100),setTimeout((()=>{t.classList.remove("show"),setTimeout((()=>t.remove()),1e3)}),3e3)}function toggleButtonLoading(e){const t=document.getElementById("submitButton"),n=t.querySelector(".button-text"),a=t.querySelector(".spinner-border");e?(t.disabled=!0,n.classList.add("d-none"),a.classList.remove("d-none")):(t.disabled=!1,n.classList.remove("d-none"),a.classList.add("d-none"))}function sendMail(e){e.preventDefault(),toggleButtonLoading(!0);const t={from:document.getElementById("email").value,isSponsor:0,subject:document.getElementById("subject").value,text:document.getElementById("message").value};fetch(rpcUrl+"/mail/sendMail?"+new URLSearchParams(t),{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"}}).then((e=>e.json())).then((e=>{showToast("Abbiamo ricevuto la tua email."),document.getElementById("email").value="",document.getElementById("subject").value="",document.getElementById("message").value="",toggleButtonLoading(!1)})).catch((e=>{console.error("Error:",e),showToast("Non siamo riusciti a ricevere la tua email :( riprova pi√π tardi."),toggleButtonLoading(!1)}))}function initContactPage(){document.getElementById("contactForm")&&document.getElementById("contactForm").addEventListener("submit",sendMail)}async function getTravelBookParam(e){try{const t=await fetch(rpcUrl+"/data/travel-book",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json(),a=n.json,o=document.getElementById("btnAction");return o&&(o.href=a[e]),n}catch(e){console.error("Error:",e.message)}}function initTravelBookPage(){if(!document.getElementById("btnAction"))return;const e=new URLSearchParams(window.location.search),t=e.get("acquire"),n=e.get("title");"yes"===t?getTravelBookParam(n):window.location.replace("/404")}initExpensesPage(),initPressPage(),initVanPage(),initTripPage(),initContactPage(),initTravelBookPage();const url="https://api.openrouteservice.org/v2/matrix/driving-car",apiKey="5b3ce3597851110001cf6248628c476c60c94a21922aa9d289a26249",gmapsUrl="https://www.google.com/maps/dir/";let totalKm=0,cities=[],lastCity=null,choicesInstance=null;function initTransiberianPage(){if(!document.getElementById("city"))return;const e=document.getElementById("city");choicesInstance=new Choices(e,{searchEnabled:!0,searchChoices:!0,itemSelectText:"Premi per selezionare",placeholderValue:"Seleziona una citt√†",searchPlaceholderValue:"Cerca una citt√†...",noResultsText:"Nessuna citt√† trovata",shouldSort:!0}),setVisaDays(),getData()}async function getData(){try{const e=await fetch(`${rpcUrl}/data/ru_it`),t=(await e.json()).json.map((e=>({value:`${e.lat},${e.lng}`,label:e.city})));choicesInstance.setChoices(t,"value","label",!0)}catch(e){console.error("Error fetching city data:",e)}}function setVisaDays(){const e=document.getElementById("visaType");document.getElementById("days").value=e.value,document.getElementById("days").innerText=e.value,calculateTotalKm(),calculateMinimumDays()}function addCity(){if(!choicesInstance)return;const e=choicesInstance.getValue();if(!e)return;if(cities.length>0&&cities[cities.length-1].name===e.label)return void alert("Non puoi inserire la stessa citt√† due volte di seguito!");const t={name:e.label,coords:e.value.split(",").map(Number)};if(cities.push(t),lastCity=t,1===cities.length)addRowToTable(t.name,0),updateButtonsState();else{document.getElementById("loader").style.display="flex";calculateDistance(cities[cities.length-2].coords,t.coords).then((e=>{document.getElementById("loader").style.display="none",e>=0?(addRowToTable(t.name,e),totalKm+=e,updateTotalKm(),updateButtonsState()):recalculateDistances()})).catch((e=>{document.getElementById("loader").style.display="none",console.error("Errore nel calcolo della distanza:",e)}))}choicesInstance.setChoiceByValue("")}async function calculateDistance(e,t){try{const n=await fetch(`https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${e[1]},${e[0]}&end=${t[1]},${t[0]}`),a=await n.json();if(a.error&&2004===a.error.code)return alert("La distanza tra le citt√† √® troppo grande. Inserisci una citt√† intermedia."),cities.pop(),-1;if(a.features&&a.features[0].properties.segments){const e=a.features[0].properties.segments[0].distance/1e3;return Math.round(e)}throw new Error("Errore nel calcolo della distanza")}catch(e){return console.error("Errore:",e),0}}function addRowToTable(e,t){const n=document.getElementById("cityTable").insertRow(),a=n.insertCell(0),o=n.insertCell(1),r=n.insertCell(2),s=n.insertCell(3);a.innerHTML=e,o.innerHTML=t.toFixed(0),r.innerHTML=calculateHoursForDistance(t),s.innerHTML='<button class="btn btn-delete2" style="z-index: auto;" onclick="deleteRow(this)">Rimuovi</button>'}function deleteRow(e){const t=e.parentNode.parentNode,n=t.rowIndex-1;document.getElementById("loader").style.display="flex",cities.splice(n,1);for(let e=1;e<cities.length;e++)cities[e].name===cities[e-1].name&&(cities.splice(e,1),e--);lastCity=cities.length>0?cities[cities.length-1]:null,t.parentNode.removeChild(t),recalculateDistances().finally((()=>{document.getElementById("loader").style.display="none"})),updateButtonsState()}async function recalculateDistances(){totalKm=0;document.getElementById("cityTable").innerHTML="";try{for(let e=0;e<cities.length;e++)if(0===e)addRowToTable(cities[e].name,0);else{const t=await calculateDistance(cities[e-1].coords,cities[e].coords);addRowToTable(cities[e].name,t),totalKm+=t}updateTotalKm(),calculateMinimumDays()}catch(e){console.error("Errore nel ricalcolo delle distanze:",e)}}function updateTotalKm(){calculateTotalKm()}function calculateHoursForDistance(e){const t=document.getElementById("averageSpeed").value;if(t>0&&e>0){return Math.ceil(e/t)}return"0"}function calculateHours(){const e=document.getElementById("cityTable").rows;for(let t=1;t<e.length;t++){const n=parseFloat(e[t].cells[1].innerHTML);e[t].cells[2].innerHTML=calculateHoursForDistance(n)}calculateMinimumDays()}function calculateTotalKm(){const e=document.getElementById("roundTrip").checked;let t=totalKm;e&&(t=2*totalKm),document.getElementById("totalKm").innerText=t.toFixed(0);const n=parseInt(document.getElementById("days").innerText);if(n>0){const e=t/n;document.getElementById("averageKm").innerText=e.toFixed(0)}else document.getElementById("averageKm").innerText="0";calculateMinimumDays()}function calculateMinimumDays(){let e=0;const t=document.getElementById("cityTable").rows;for(let n=1;n<t.length;n++){e+=parseInt(t[n].cells[2].innerHTML)}document.getElementById("roundTrip").checked&&(e*=2);const n=Math.ceil(e/8),a=document.getElementById("averageDay");a.innerText=n>0?n:"0";const o=parseInt(document.getElementById("days").innerText);a.style.color=n>o?"#dc3545":""}function openGoogleMaps(){let e=gmapsUrl;for(let t=0;t<cities.length;t++)e+=encodeURIComponent(cities[t].name)+"/";e=e.slice(0,-1),window.open(e,"_blank")}function updateButtonsState(){const e=document.getElementById("viewOnGoogleMaps"),t=document.getElementById("exportToExcel");cities.length>=2?(e&&(e.disabled=!1),t&&(t.disabled=!1)):(e&&(e.disabled=!0),t&&(t.disabled=!0))}async function translateContent(){const e=document.querySelector(".content.drop-cap"),t=document.querySelector('button[onclick="translateContent()"]');if(!e)return void console.error("Elemento .content.drop-cap non trovato");if(e.classList.contains("translated"))t.innerHTML='<i class="fas fa-spinner fa-spin me-2 text-primary"></i><span class="text-primary d-inline-block d-md-none">Ripr...</span><span class="text-primary d-none d-md-inline-block">Restoring...</span>',t.disabled=!0,e.innerHTML=e.getAttribute("data-original-content"),e.classList.remove("translated"),t.disabled=!1,t.innerHTML='<i class="fas fa-language me-2 text-primary"></i><span class="text-primary d-inline-block d-md-none">Trad.</span><span class="text-primary d-none d-md-inline-block">Translate to English</span>';else{t.innerHTML='<i class="fas fa-spinner fa-spin me-2 text-primary"></i><span class="text-primary d-inline-block d-md-none">Trad...</span><span class="text-primary d-none d-md-inline-block">Translating...</span>',t.disabled=!0,e.setAttribute("data-original-content",e.innerHTML);const a=e.querySelectorAll("h1, h2, h3, h4, h5, h6, p, li, span, figcaption"),o=document.querySelector("h3.mb-4");async function n(e){if(e.nodeType===Node.TEXT_NODE&&""!==e.textContent.trim()){const t=e.textContent.match(/^\s+/)?.[0]||"",n=e.textContent.match(/\s+$/)?.[0]||"",a=e.textContent.trim(),o=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=it&tl=en&dt=t&q=${encodeURIComponent(a)}`;try{const r=await fetch(o);let s=(await r.json())[0].map((e=>e[0])).join("");s=t+s+n,a[0]!==a[0].toUpperCase()&&(s=s.charAt(0).toLowerCase()+s.slice(1)),e.textContent=s}catch(e){console.error("Errore nella traduzione:",e)}}else if(e.nodeType===Node.ELEMENT_NODE){const t=Array.from(e.childNodes);for(const e of t)await n(e)}}o&&a.push(o);for(const r of a)if(""!==r.textContent.trim()){const s=document.createElement("div");s.innerHTML=r.innerHTML,await n(s),r.innerHTML=s.innerHTML}e.classList.add("translated"),t.disabled=!1,t.innerHTML='<i class="fas fa-language me-2 text-primary"></i><span class="text-primary d-inline-block d-md-none">Orig.</span><span class="text-primary d-none d-md-inline-block">View original</span>'}}function handleSubscribe(e){e.preventDefault();const t=document.getElementById("newsletterEmail").value,n=encodeURIComponent(t);window.open(`https://vandipety.substack.com/subscribe?just_signed_up=true&skip_redirect_check=true&utm_medium=web&utm_source=embed&freeSignupEmail=${n}`,"_blank")}function shareOnSocial(e){const t=document.querySelector("h1")?.textContent||document.title,n=window.location.href,a={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`,threads:`https://www.threads.net/intent/post?text=${encodeURIComponent(t)}%20-%20${encodeURIComponent(n)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}&url=${encodeURIComponent(n)}`,whatsapp:`https://wa.me/?text=${encodeURIComponent(t+" "+n)}`,telegram:`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(t)}`};return"copy"===e?(navigator.clipboard.writeText(n).then((()=>{showToast("Link copiato negli appunti!")})),!1):(window.open(a[e],"_blank"),!1)}document.addEventListener("DOMContentLoaded",initTransiberianPage);let modalid="#satispay";function openModal(){document.querySelector(modalid).classList.add("show"),document.body.style.overflow="hidden"}function closeModal(){document.querySelector(modalid).classList.remove("show"),document.body.style.overflow="auto"}async function getFirstPublicVideoThumbnail(e,t,n){try{const a=await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,status&maxResults=50&playlistId=${e}&key=${t}`),o=await a.json();if(o.items){const e=o.items.find((e=>e.status&&"public"===e.status.privacyStatus));if(e){const t=e.snippet.resourceId.videoId,a=`https://img.youtube.com/vi_webp/${t}/maxresdefault.webp`,o=`https://img.youtube.com/vi/${t}/maxresdefault.jpg`,r=new Image;r.onload=function(){n&&(n.style.backgroundImage=`url('${a}')`)},r.onerror=function(){n&&(n.style.backgroundImage=`url('${o}')`)},r.src=a}else console.log("Nessun video pubblico trovato nella playlist")}}catch(e){console.error("Errore nel caricamento dell'anteprima:",e)}}function handleVideoClick(e,t,n,a,o){e.style.opacity="0",e.style.transition="opacity 0.3s ease-in-out",t.style.opacity="1",t.style.pointerEvents="auto",n.src=o?`https://www.youtube-nocookie.com/embed/videoseries?list=${a}&autoplay=1`:`https://www.youtube-nocookie.com/embed/${a}?autoplay=1`,setTimeout((()=>{e.style.display="none"}),300)}document.addEventListener("DOMContentLoaded",(function(){const e=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){const n=t.target;n.src=n.dataset.src,e.unobserve(n)}}))}),{rootMargin:"50px 0px",threshold:.1});document.querySelectorAll("iframe[data-src]").forEach((t=>{e.observe(t)}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".youtube-facade[data-video-id]").forEach((e=>{if(!e)return;const t=e.dataset.videoId,n="true"===e.dataset.isPlaylist,a=e.dataset.apiKey,o=e.id.split("-")[2],r=document.getElementById(`iframe-${o}`),s=document.getElementById(`youtube-iframe-${o}`);r&&s&&(n&&getFirstPublicVideoThumbnail(t,a,e),e.addEventListener("click",(function(a){a.preventDefault(),handleVideoClick(e,s,r,t,n)})))}));const e=document.querySelector(".widget.newsletter-widget .youtube-facade"),t=document.querySelector(".widget.newsletter-widget .youtube-iframe iframe"),n=document.querySelector(".widget.newsletter-widget .youtube-iframe");if(e&&t&&n){const a="PLHaclq_J5PZ_gu1kNkYx-mEQPchUK3Wzh";getFirstPublicVideoThumbnail(a,"AIzaSyB-m8BmXqPNdNSyTanaww8Uv51TzXKzsqU",e),e.addEventListener("click",(function(o){o.preventDefault(),handleVideoClick(e,n,t,a,!0)}))}})),document.addEventListener("DOMContentLoaded",(function(){setInterval((function(){document.querySelectorAll("iframe").forEach((function(e){let t=e.getAttribute("src");t&&t.match(/(ads-iframe)|(disqusads)/gi)&&e.remove()}))}),300)}));const toggleSideNav=document.querySelector(".toggle-side-nav"),offcanvas=document.getElementById("offcanvasRight"),offcanvasBackdrop=document.createElement("div");if(offcanvasBackdrop.className="offcanvas-backdrop fade",toggleSideNav&&offcanvas){document.body.appendChild(offcanvasBackdrop),toggleSideNav.addEventListener("click",handleMenuToggle),toggleSideNav.addEventListener("touchstart",handleMenuToggle);const e=offcanvas.querySelector(".btn-close");e&&(e.addEventListener("click",closeMenu),e.addEventListener("touchstart",closeMenu)),offcanvasBackdrop.addEventListener("click",closeMenu),offcanvasBackdrop.addEventListener("touchstart",closeMenu),document.addEventListener("keydown",handleEscape)}function handleMenuToggle(e){e.preventDefault(),offcanvas.classList.toggle("show"),offcanvasBackdrop.classList.toggle("show"),document.body.classList.toggle("offcanvas-open")}function closeMenu(){offcanvas.classList.remove("show"),offcanvasBackdrop.classList.remove("show"),document.body.classList.remove("offcanvas-open")}function handleEscape(e){"Escape"===e.key&&closeMenu()}
