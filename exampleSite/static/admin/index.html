<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.1.0/dist/decap-cms.js"></script>
    
    <!-- Custom Widgets for Hugo Shortcodes -->
    <script>
      // Custom widget per shortcode indice (tabella dei contenuti)
      CMS.registerEditorComponent({
        id: "indice",
        label: "Indice/Tabella dei Contenuti",
        fields: [
          {
            name: 'title',
            label: 'Titolo (opzionale)',
            widget: 'string',
            required: false,
            hint: 'Personalizza il titolo dell\'indice (default: "Tabella dei contenuti")'
          },
          {
            name: 'collapsed',
            label: 'Inizia chiuso',
            widget: 'boolean',
            default: true,
            required: false,
            hint: 'Se vero, l\'indice inizia collassato'
          }
        ],
        pattern: /^{{<\s*indice\s*(?:title="([^"]*)")?\s*(?:collapsed=(true|false))?\s*>}}$/,
        fromBlock: function(match) {
          return {
            title: match[1] || '',
            collapsed: match[2] !== 'false'
          };
        },
        toBlock: function(obj) {
          let shortcode = '{{< indice';
          if (obj.title) {
            shortcode += ` title="${obj.title}"`;
          }
          if (obj.collapsed === false) {
            shortcode += ' collapsed=false';
          }
          shortcode += ' >}}';
          return shortcode;
        },
        toPreview: function(obj) {
            return h('div', {
              style: {
                border: '2px dashed #ccc',
                padding: '10px',
                borderRadius: '4px',
                backgroundColor: '#f9f9f9',
                color: '#666'
              }
            }, [
              h('strong', null, 'ðŸ“‹ Indice: '),
              h('span', null, obj.title || 'Tabella dei contenuti'),
              h('br', null),
              h('small', null, 'Genera automaticamente l\'indice dai titoli H2-H5 del post')
            ]);
          }
      });

      // Inizializza il CMS
      CMS.init();
    </script>
  </body>
</html>
